<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>GFZ-Rechner Perchtoldsdorf</title>
  <style>
    body { font-family: sans-serif; padding: 30px; max-width: 600px; margin: auto; }
    label, input { display: block; margin: 10px 0; width: 100%; }
    button { padding: 10px 15px; font-size: 16px; }
    .result { margin-top: 20px; font-size: 18px; font-weight: bold; }
    #save-status { margin-top: 10px; padding: 10px; border-radius: 5px; }
    .success { background-color: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
    .error { background-color: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
    .loading { background-color: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
  </style>
</head>
<body>
  <h1>GFZ-Rechner Perchtoldsdorf</h1>
  <p>Gib Adresse, Grundst√ºcksfl√§che, verbaute Fl√§che und Geschossanzahl ein:</p>
  
  <label for="adresse">Adresse:</label>
  <input type="text" id="adresse" placeholder="z.B. Marktplatz 1">
  
  <label for="grundst√ºck">Grundst√ºcksfl√§che (m¬≤):</label>
  <input type="number" id="grundst√ºck" placeholder="z.B. 600" step="0.01">
  
  <label for="verbaute">Verbaute Fl√§che (m¬≤ pro Geschoss):</label>
  <input type="number" id="verbaute" placeholder="z.B. 200" step="0.01">
  
  <label for="geschosse">Anzahl der oberirdischen Geschosse:</label>
  <input type="number" id="geschosse" placeholder="z.B. 2">
  
  <button onclick="berechneGFZ()">GFZ berechnen</button>
  
  <div class="result" id="ergebnis"></div>

  <script>
  function berechneGFZ() {
    const adresse = document.getElementById("adresse").value;
    const grundst√ºck = parseFloat(document.getElementById("grundst√ºck").value);
    const verbaute = parseFloat(document.getElementById("verbaute").value);
    const geschosse = parseFloat(document.getElementById("geschosse").value);
    const ergebnisDiv = document.getElementById("ergebnis");
    
    // Validation
    if (!adresse || isNaN(grundst√ºck) || isNaN(verbaute) || isNaN(geschosse) ||
        grundst√ºck <= 0 || verbaute <= 0 || geschosse <= 0) {
      ergebnisDiv.innerHTML = "‚ùó Bitte alle Felder korrekt ausf√ºllen.";
      return;
    }
    
    // Calculate GFZ
    const gesamtfl√§che = verbaute * geschosse;
    const gfz = (gesamtfl√§che / grundst√ºck).toFixed(2);
    
    // Show result
    ergebnisDiv.innerHTML = `
      üìç Adresse: <strong>${adresse}</strong><br>
      ‚úÖ GFZ: <strong>${gfz}</strong><br>
      (zul√§ssig: max. 1,0 im Ortszentrum Perchtoldsdorf)
      <div id="save-status" class="loading">üíæ Speichere Daten...</div>
    `;
    
    // Send data using form submission (bypasses CORS)
    sendDataToSheet(adresse, grundst√ºck, verbaute, geschosse, gfz);
  }
  
  function sendDataToSheet(adresse, grundst√ºck, verbaute, geschosse, gfz) {
    // Create form
    const form = document.createElement('form');
    form.method = 'POST';
    form.action = 'https://script.google.com/macros/s/AKfycbx1ZQhReFYfZ06qPgKea-cMxeDcCZSle8YIOXfVtabVEXYQg7EfIHuBPjOEA3pyVyBa/exec';
    form.target = 'hidden_iframe';
    
    // Create form fields
    const fields = {
      adresse: adresse,
      grundst√ºck: grundst√ºck,
      verbaute: verbaute,
      geschosse: geschosse,
      gfz: parseFloat(gfz)
    };
    
    Object.keys(fields).forEach(key => {
      const input = document.createElement('input');
      input.type = 'hidden';
      input.name = key;
      input.value = fields[key];
      form.appendChild(input);
    });
    
    // Create or get hidden iframe
    let iframe = document.getElementById('hidden_iframe');
    if (!iframe) {
      iframe = document.createElement('iframe');
      iframe.id = 'hidden_iframe';
      iframe.name = 'hidden_iframe';
      iframe.style.display = 'none';
      document.body.appendChild(iframe);
    }
    
    // Handle iframe load (indicates form submission completed)
    iframe.onload = function() {
      const saveStatusDiv = document.getElementById("save-status");
      if (saveStatusDiv) {
        saveStatusDiv.innerHTML = "‚úÖ Daten erfolgreich gespeichert!";
        saveStatusDiv.className = "success";
      }
      
      // Clean up form
      if (form.parentNode) {
        form.parentNode.removeChild(form);
      }
    };
    
    // Handle iframe error
    iframe.onerror = function() {
      const saveStatusDiv = document.getElementById("save-status");
      if (saveStatusDiv) {
        saveStatusDiv.innerHTML = "‚ùå Fehler beim Speichern";
        saveStatusDiv.className = "error";
      }
    };
    
    // Submit form
    document.body.appendChild(form);
    
    // Add timeout fallback
    setTimeout(function() {
      const saveStatusDiv = document.getElementById("save-status");
      if (saveStatusDiv && saveStatusDiv.innerHTML.includes("Speichere")) {
        saveStatusDiv.innerHTML = "‚úÖ Daten gesendet (Status unbekannt)";
        saveStatusDiv.className = "success";
      }
      
      // Clean up form
      if (form.parentNode) {
        form.parentNode.removeChild(form);
      }
    }, 3000);
    
    form.submit();
  }
  </script>
</body>
</html>
